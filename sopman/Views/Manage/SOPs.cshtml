@model IEnumerable<sopman.Models.ManageViewModels.SOPOverView> 
@using HtmlHelpers.BeginCollectionItemCore
@using Microsoft.AspNetCore.Identity
@{
    ViewData["Title"] = "The SOP";
    int sectioncount = 0;
    int subsectioncount = 0;
    int tasks = 0; // A second section counter to reset the count for the 'Tasks' tab
    int documentsProcesses = 1;
}
<div class="container body-content">
    <form action="" method="post" enctype="multipart/form-data">
    <div class="container sop-builder">
        <div class="row header-dark-grey">
            <div class="col-12 col-md-8">
                <p>@ViewBag.thecode @ViewBag.instref <span class="faded">Executed by: </span>@foreach(var name in (ViewBag.userinfo)){<span>@name.FirstName </span> <span> @name.SecondName</span> }</p>
            </div>
            <div class="col-12 col-md-4 text-right">
                <p>Review Date: @ViewBag.expire</p>
            </div>
            <hr class="white-divider"/>
            <div class="col-12 col-md-7">
                <h1>@ViewBag.temp </h1>
                <p class="theproject">Project: <a href="">@ViewBag.proj</a></p>
            </div>
            <div class="col-12 col-md-3 d-flex align-items-center text-center">
                <style>
                    circle {
                        fill: #96C9DB;
                        stroke: #456074;
                        stroke-width: 32;
                        transition: .5s;
                    }
                     .pie {
                      width: 100px;
                      background: #96C9DB;
                      border-radius: 50%;
                    }   
                </style>
                <svg viewBox="0 0 64 64" class="pie">
                    <circle r="25%" cx="50%" cy="50%" style="stroke-dasharray: @ViewBag.percentageComplete 100">
                    </circle>
                </svg>
                <h5 class="mx-auto">@ViewBag.percentageComplete%<br /><span class="h6 text-muted">Complete</span></h5>
            </div>
            <div class="col-12 col-md-2 text-right">
                <a class="btn white-btn mod-btn" href="/Manage/EditSOP?=@ViewBag.exeid">Modify</a>
                <div class="my-1 lower-btn">
                    <a class="btn white-btn mod-btn status-btn @ViewBag.sopstatus" href="/Manage/ArchiveInstance?=@ViewBag.exeid">Archive</a>
                    <div class="lower-btn">
                        <a class="btn blue-btns mod-btn status-btn @ViewBag.sopstatus" href="/Manage/ArchiveInstance?=@ViewBag.exeid">Archive</a>
                    </div>    
                </div>
            </div>
            <hr class="invisible-divider"/>
            <div class="col-12">
                <ul class="nav nav-temp nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#overview" role="tab">SOP Overview</a>
                    </li>
                    <li class="nav-item ml-2">
                        <a class="nav-link" data-toggle="tab" href="#process" role="tab">Process Steps</a>
                    </li>
                    <li class="nav-item ml-2">
                        <a class="nav-link" data-toggle="tab" href="#activity" role="tab">Activity</a>
                    </li>
                    <li class="nav-item ml-2">
                        <a class="nav-link" data-toggle="tab" href="#history" role="tab">My Tasks</a>
                    </li>
                    <li class="nav-item ml-2">
                        <a class="nav-link" data-toggle="tab" href="#docs" role="tab">Documents</a>
                    </li> 
                </ul>
            </div>
        </div>
        <div class="row white-row">
            <div class="col-12">
                <div class="tab-content">
                    <div class="tab-pane active" id="overview" role="tabpanel">
                        @foreach(var subitem in (ViewBag.thesecs)){
                            sectioncount++;
                            tasks++;
                        
                            <div class="row section-count">
                                <div class="col-12 col-md-1 header-left">
                                    <div class="number"><h3 class="h5">@sectioncount</h3></div>
                                </div>
                                <div class="col-12 col-md-11 header-right">
                                    <h2>@subitem.SectionText</h2>
                                </div>
                                <div class="col-12 the-secs">
                                   @foreach(var item in (ViewBag.thesin)){
                                        if(item.valuematch == subitem.valuematch){
                                            if(item.NewTempId == @ViewBag.gettopid){
                                                <h3>@item.SingleLinkTextBlock</h3>
                                            }
                                        }
                                    }
                                    @foreach(var item in (ViewBag.gettabs)){
                                        if(item.valuematch == subitem.valuematch){
                                            if(item.NewTempId == @ViewBag.gettopid){
                                                <h3>@item.TableHTML</h3>
                                                <div class="col-12">
                                                    <div class="table sop-table">
                                                        <div class="col-count">
                                                        @foreach(var col in (ViewBag.gettabscols)){
                                                            if((col.tableval == subitem.valuematch) && (col.NewTempId == ViewBag.gettopid)){
                                                                <div class="inner-cols">
                                                                    <h3>@col.ColText</h3>
                                                                </div>
                                                            }
                                                        }
                                                        </div>
                                                        <div class="row-count">
                                                        @foreach(var col in (ViewBag.gettabsrows)){
                                                            if((col.tableval == subitem.valuematch) && (col.NewTempId == ViewBag.gettopid)){
                                                                <div class="inner-rows">
                                                                    <h3>@col.RowText</h3>
                                                                </div>
                                                            }
                                                        }
                                                        </div>
                                                    </div>
                                                </div>
                                             }
                                        }
                                    }
                                    @foreach(var item in (ViewBag.getmul)){
                                        if(item.valuematch == subitem.valuematch){
                                           if(item.NewTempId == @ViewBag.gettopid){
                                                <p>@item.MultilineTextBlock</p>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                        }
                     </div>
                     <div class="tab-pane" id="process" role="tabpanel">
                        <div id="accordion" role="tablist">
                            @foreach(var item in (ViewBag.processtmps)){
                                var nameshort = item.ProcessName.Replace(" ", "");
                                var protype = item.ProcessType;
                                var value = item.valuematch;
                                string number;
                                if(protype == "SubProcess")
                                {
                                    number = sectioncount.ToString() + "." + subsectioncount.ToString();
                                    subsectioncount++;
                                    
                                }
                                else
                                {
                                    sectioncount++;
                                    number = sectioncount.ToString();
                                    subsectioncount = 1;
                                }
                                int resCount = 1;
                                int accCount = 1;
                                int conCount = 1;
                                int infCount = 1;
                                <div class="card section-count process-count status-is-@item.processStatus container @protype process-@value">
                                    <div class="card-header row" role="tab" id="headingOne">
                                        <div class="col-12 col-md-1 count-col">
                                            <div class="number"><h3 class="h5">@number</h3></div>
                                        </div>
                                        <div class="col-12 col-md-11 padding-left-zero">
                                            <div class="row header-row">
                                                <div class="col-12 col-md-10">
                                                     <h3>@item.ProcessName</h3>
                                                </div>
                                                <div class="col-12 col-md-2 text-right">
                                                    <a data-toggle="collapse" class="collapsed" href="#collapse-@nameshort" role="button" aria-expanded="false" aria-controls="collapseOne">
                                                        SHOW DETAIL
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 status-row">
                                                @if(item.processStatus == "Complete"){
                                                    <div class="row complete-status">
                                                        <div class="col-12  col-md-1">
                                                        </div>
                                                        <div class="col-11">
                                                            <p>Completed on: @item.completedDate.ToString("dd/MM/yyyy")</p>
                                                        </div>
                                                    </div>
                                                }
                                                else {
                                                    <div class="row pending-status">
                                                        <div class="col-12 col-md-1">
                                                        </div>
                                                        <div class="col-11 status-is-pending">
                                                            @foreach(var date in (ViewBag.instpocess)){
                                                                if((date.valuematch == item.valuematch) && (date.SOPTemplateID == @ViewBag.getinstanceid)){
                                                                    <p class="the-due-date">Due: @date.DueDate</p>
                                                                }
                                                            }
                                                            <p class="the-proc-status">@item.processStatus</p>
                                                        </div>
                                                    </div>
                                                }
                                        </div>
                                    </div>
                                    <div id="collapse-@nameshort" class="container collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                                        <div class="card-body sops-raci-info row">
                                            <div class="col-12 col-md-12">
                                                <p>@item.ProcessDesc</p>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    <div class="col-12 raci-info">
                                                        <h4>Responsible</h4>
                                                    </div>
                                                    @foreach(var sub in (ViewBag.res)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                            <div class="col-12 col-md-12 res-row-@item.valuematch no-pad grey-bg">
                                                                <div class="row">
                                                                <!-- Getting the first and second name from users -->
                                                                @foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId){
                                                                        var namenospace = "resp" + name.FirstName + name.SecondName + sub.RACIResID + item.valuematch;
                                                                        <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                            <h3 class="h5">@resCount</h3>
                                                                        </div>
                                                                        <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                            <input type="hidden" value="@item.valuematch">
                                                                            <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                            <h5>@sub.Status</h5>
                                                                        </div>
                                                                        <div class="col-12 col-md-6 sop-person d-flex flex-column justify-content-center">
                                                                            <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                            <!-- Getting the department -->    
                                                                            @foreach(var dep in (ViewBag.deps)){
                                                                                if(sub.DepartmentId == dep.DepartmentId){
                                                                                    <p class="mb-0">@dep.DepartmentName</p>
                                                                                }
                                                                            }
                                                                        </div>
                                                                        <div class="col-12 col-md-2 sop-buttons">
                                                                            <div class="dropdown h-100">
                                                                              <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="material-icons">menu</i>
                                                                              </button>
                                                                              <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@namenospace"><p>Complete Task</p></div>
                                                                                <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@namenospace"><p>Request recusal</p></div>

                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal fade" id="comp-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Complete this task</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>Add signature</p>
                                                                                    <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Complete Task" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        <div class="modal fade" id="rec-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Request Recusal</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                    <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Request Recusal" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        resCount++;
                                                                    }
                                                                 }
                                                                 </div>
                                                            </div>
                                                        }
                                                    }
                                                    <script>
                                                        $(document).ready(function() {
                                                            var nlenth = $('.res-row-@item.valuematch').length;
                                                            if($(".res-row-@item.valuematch").length > 1){
                                                               console.log(nlenth);
                                                                $(".res-row-@item.valuematch:nth-child(3n)").addClass("hide-this");
                                                            }
                                                            $(".row-Recused.res-row-@item.valuematch").next('.res-row-@item.valuematch').addClass('show-div').removeClass("hide-this");
                                                            $(".row-Recused.res-row-@item.valuematch").addClass("hide-this");
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    <div class="col-12 raci-info">
                                                        <h4>Accountable</h4>
                                                    </div>
                                                    @foreach(var sub in (ViewBag.acc)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                            <div class="col-12 col-md-12 acc-row-@item.valuematch row-@sub.Status no-pad grey-bg">
                                                                <div class="row">
                                                                <!-- Getting the first and second name from users -->
                                                                @foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId){
                                                                        var namenospace = "acc" + name.FirstName + name.SecondName + sub.RACIAccID + item.valuematch;
                                                                        <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                            <h3 class="h5">@accCount</h3>
                                                                        </div>
                                                                        <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                            <input type="hidden" value="@item.valuematch">
                                                                            <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                            <h5>@sub.Status</h5>
                                                                        </div>
                                                                        <div class="col-12 col-md-6 sop-person d-flex flex-column justify-content-center">
                                                                            <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                            <!-- Getting the department -->    
                                                                            @foreach(var dep in (ViewBag.deps)){
                                                                                if(sub.DepartmentId == dep.DepartmentId){
                                                                                    <p class="mb-0">@dep.DepartmentName</p>
                                                                                }
                                                                            }
                                                                        </div>
                                                                        <div class="col-12 col-md-2 sop-buttons">
                                                                            <div class="dropdown h-100">
                                                                              <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="material-icons">menu</i>
                                                                              </button>
                                                                              <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@namenospace"><p>Complete Task</p></div>
                                                                                <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@namenospace"><p>Request recusal</p></div>
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal fade" id="comp-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Complete this task</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>Add signature</p>
                                                                                    <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Complete Task" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        <div class="modal fade" id="rec-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Request Recusal</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                    <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Request Recusal" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        accCount++;
                                                                    }
                                                                 }
                                                                 </div>
                                                            </div>

                                                        }
                                                    }
                                                    <script>
                                                        $(document).ready(function() {
                                                            var nlenth = $('.acc-row-@item.valuematch').length;
                                                            if($(".acc-row-@item.valuematch").length > 1){
                                                               console.log(nlenth);
                                                                $(".acc-row-@item.valuematch:nth-child(3n)").addClass("hide-this");
                                                            }
                                                            $(".row-Recused.acc-row-@item.valuematch").next('.acc-row-@item.valuematch').addClass('show-div').removeClass("hide-this");
                                                            $(".row-Recused.acc-row-@item.valuematch").addClass("hide-this");
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    <div class="col-12 raci-info">
                                                        <h4>Consulted</h4>
                                                    </div>
                                                    @foreach(var sub in (ViewBag.cons)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                            <div class="col-12 col-md-12 con-row-@item.valuematch no-pad grey-bg">
                                                                <div class="row">
                                                                <!-- Getting the first and second name from users -->
                                                                @foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId){
                                                                        var namenospace = "cons" + name.FirstName + name.SecondName + sub.RACIConID + item.valuematch;
                                                                        <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                            <h3 class="h5">@conCount</h3>
                                                                        </div>
                                                                        <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                            <input type="hidden" value="@item.valuematch">
                                                                            <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                            <h5>@sub.Status</h5>
                                                                        </div>
                                                                        <div class="col-12 col-md-6 sop-person d-flex flex-column justify-content-center">
                                                                            <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                            <!-- Getting the department -->    
                                                                            @foreach(var dep in (ViewBag.deps)){
                                                                                if(sub.DepartmentId == dep.DepartmentId){
                                                                                    <p class="mb-0">@dep.DepartmentName</p>
                                                                                }
                                                                            }
                                                                        </div>
                                                                        <div class="col-12 col-md-2 sop-buttons">
                                                                            <div class="dropdown h-100">
                                                                              <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="material-icons">menu</i>
                                                                              </button>
                                                                              <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@namenospace"><p>Complete Task</p></div>
                                                                                <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@namenospace"><p>Request recusal</p></div>
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal fade" id="comp-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Complete this task</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>Add signature</p>
                                                                                    <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Complete Task" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        <div class="modal fade" id="rec-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Request Recusal</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                    <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Request Recusal" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        conCount++;
                                                                    }
                                                                 }
                                                                 </div>
                                                            </div>
                                                        }
                                                    }
                                                    <script>
                                                        $(document).ready(function() {
                                                            var nlenth = $('.con-row-@item.valuematch').length;
                                                            if($(".con-row-@item.valuematch").length > 1){
                                                               console.log(nlenth);
                                                                $(".con-row-@item.valuematch:nth-child(3n)").addClass("hide-this");
                                                            }
                                                            $(".row-Recused.con-row-@item.valuematch").next('.con-row-@item.valuematch').addClass('show-div').removeClass("hide-this");
                                                            $(".row-Recused.con-row-@item.valuematch").addClass("hide-this");
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    <div class="col-12 raci-info">
                                                        <h4>Informed</h4>
                                                    </div>
                                                    @foreach(var sub in (ViewBag.infi)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                            <div class="col-12 col-md-12 infi-row-@item.valuematch no-pad grey-bg">
                                                                <div class="row">
                                                                <!-- Getting the first and second name from users -->
                                                                @foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId){
                                                                        var namenospace = "infi" + name.FirstName + name.SecondName + sub.RACIInfID + item.valuematch;
                                                                        <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                            <h3 class="h5">@infCount</h3>
                                                                        </div>
                                                                        <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                            <input type="hidden" value="@item.valuematch">
                                                                            <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                            <h5>@sub.Status</h5>
                                                                        </div>
                                                                        <div class="col-12 col-md-6 sop-person d-flex flex-column justify-content-center">
                                                                            <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                            <!-- Getting the department -->    
                                                                            @foreach(var dep in (ViewBag.deps)){
                                                                                if(sub.DepartmentId == dep.DepartmentId){
                                                                                    <p class="mb-0">@dep.DepartmentName</p>
                                                                                }
                                                                            }
                                                                        </div>
                                                                        <div class="col-12 col-md-2 sop-buttons">
                                                                            <div class="dropdown h-100">
                                                                              <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="material-icons">menu</i>
                                                                              </button>
                                                                              <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@namenospace"><p>Complete Task</p></div>
                                                                                <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@namenospace"><p>Request recusal</p></div>
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal fade" id="comp-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Complete this task</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>Add signature</p>
                                                                                    <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Complete Task" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        <div class="modal fade" id="rec-@namenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Request Recusal</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                    <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Request Recusal" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        infCount++;
                                                                    }
                                                                 }
                                                                 </div>
                                                            </div>
                                                        }
                                                    }
                                                    <script>
                                                        $(document).ready(function() {
                                                            var nlenth = $('.infi-row-@item.valuematch').length;
                                                            if($(".infi-row-@item.valuematch").length > 1){
                                                               console.log(nlenth);
                                                                $(".infi-row-@item.valuematch:nth-child(3n)").addClass("hide-this");
                                                            }
                                                            $(".row-Recused.infi-row-@item.valuematch").next('.infi-row-@item.valuematch').addClass('show-div').removeClass("hide-this");
                                                            $(".row-Recused.infi-row-@item.valuematch").addClass("hide-this");    
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                    $(document).ready(function() {    
                                        if ($(".process-@value").is(".status-active")){
                                            $(".sops-raci-info.process-@value").addClass("status-active");
                                            $(".status-active.process-@value .status-row .pending-status .status-is-pending p.the-proc-status").text("ACTIVE");
                                        }
                                     });
                                </script>
                            }
                        </div>
                    </div>
                    <div class="tab-pane" id="activity" role="tabpanel">
                        <div class="row">
                            <div class="col-12 col-md-9">
                                  @foreach(var item in (ViewBag.comments)) {
                                        <div class="card commentcard row">
                                            <div class="card-header col-12">
                                                <div class="row card-row">
                                                    <div class="col-4 comment-bubble col-md-1">
                                                        <img src="/images/comment.png">
                                                    </div>
                                                    <div class="col-8 col-md-11 comment-person">
                                                        <p class="mb-1 com-date"><small class="text-muted">@item.PostTime.ToString("dd MMM yyyy")</small></p>
                                                         @foreach(var name in (ViewBag.allusers)){
                                                            if(item.UserId == name.ClaimId){
                                                                <p class="mb-1"><b>@name.FirstName @name.SecondName</b>&nbsp;posted a comment</p>
                                                            }
                                                         }
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="card-body row">
                                                <div class="col-4 col-md-1"></div>
                                                <div class="col-8 col-md-11"><p class="mb-1">@item.TheComment</p></div>
                                            </div>
                                        </div>

                                  }
                                @foreach(var item in (ViewBag.processtmps)){
                                    var pending = "Pending";
                                    foreach(var sub in (ViewBag.res)){
                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                            if(sub.Status == "Pending"){
                                            }else {
                                                foreach(var name in (ViewBag.allusers)){
                                                    if(sub.UserId == name.ClaimId){
                                                    <div class="card commentcard row">
                                                            <div class="card-header col-12">
                                                            <div class="row tick-row">
                                                                <div class="col-4 complete-tick col-md-1">
                                                                    <img src="/images/completetick.png">
                                                                </div>
                                                                <div class="col-8 col-md-11 right-comment">
                                                                    <p class="mb-1 com-date"><small class="text-muted">@sub.editDate.ToString("dd MMM yyyy")</small></p>
                                                                    <p class="mb-1"><b>@name.FirstName @name.SecondName</b>&nbsp;has completed @item.ProcessName</p>
                                                                 </div>       
                                                             </div>
                                                         </div>
                                                    </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    foreach(var sub in (ViewBag.acc)){
                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                            if(sub.Status == "Pending"){
                                            }else {
                                               foreach(var name in (ViewBag.allusers)){
                                                    if(sub.UserId == name.ClaimId){
                                                    <div class="card commentcard row">
                                                            <div class="card-header col-12">
                                                            <div class="row tick-row">
                                                                <div class="col-4 complete-tick col-md-1">
                                                                    <img src="/images/completetick.png">
                                                                </div>
                                                                <div class="col-8 col-md-11 right-comment">
                                                                    <p class="mb-1 com-date"><small class="text-muted">@sub.editDate.ToString("dd MMM yyyy")</small></p>
                                                                    <p class="mb-1"><b>@name.FirstName @name.SecondName</b>&nbsp;has completed @item.ProcessName</p>
                                                                 </div>       
                                                             </div>
                                                         </div>
                                                    </div>
                                                    }
                                                }
                                            }
                                         }
                                    }
                                    foreach(var sub in (ViewBag.cons)){
                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                            if(sub.Status == "Pending"){
                                            }else {
                                                foreach(var name in (ViewBag.allusers)){
                                                    if(sub.UserId == name.ClaimId){
                                                    <div class="card commentcard row">
                                                        <div class="card-header col-12">
                                                            <div class="row tick-row">
                                                                <div class="col-4 complete-tick col-md-1">
                                                                    <img src="/images/completetick.png">
                                                                </div>
                                                                <div class="col-8 col-md-11 right-comment">
                                                                    <p class="mb-1 com-date"><small class="text-muted">@sub.editDate.ToString("dd MMM yyyy")</small></p>
                                                                    <p class="mb-1"><b>@name.FirstName @name.SecondName</b>&nbsp;has completed @item.ProcessName</p>
                                                                 </div>       
                                                             </div>
                                                         </div>
                                                    </div>
                                                    }
                                                }
                                            }
                                         }
                                    }
                                    foreach(var sub in (ViewBag.infi)){
                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                             if(sub.Status == "Pending"){
                                            }else {
                                               foreach(var name in (ViewBag.allusers)){
                                                    if(sub.UserId == name.ClaimId){
                                                    <div class="card commentcard row">
                                                            <div class="card-header col-12">
                                                            <div class="row tick-row">
                                                                <div class="col-4 complete-tick col-md-1">
                                                                    <img src="/images/completetick.png">
                                                                </div>
                                                                <div class="col-8 col-md-11 right-comment">
                                                                    <p class="mb-1 com-date"><small class="text-muted">@sub.editDate.ToString("dd MMM yyyy")</small></p>
                                                                    <p class="mb-1"><b>@name.FirstName @name.SecondName</b>&nbsp;has completed @item.ProcessName</p>
                                                                 </div>       
                                                             </div>
                                                         </div>
                                                    </div>
                                                    }
                                                }
                                            }
                                        }
                                    }

                                }

                                <div class="row mt-3">
                                    <div class="col-12">
                                        <textarea class="w-100 p-2" placeholder="Add a comment" name="newcomment"></textarea>
                                    </div>
                                    <div class="col-12 d-flex flex-row-reverse">
                                        <button type="submit" value="post" class="comment-btn btn btn-secondary">POST</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-2">
                                
                            </div>
                        </div>
                     </div>
                     @{
                        sectioncount = tasks;
                    }
                    <div class="tab-pane" id="history" role="tabpanel">
                        <div id="accordion-history" role="tablist">
                            @foreach(var item in (ViewBag.processtmps)){
                                var nameshort = item.ProcessName.Replace(" ", "");
                                var protype = item.ProcessType;
                                var value = item.valuematch;

                                string number;
                                if(protype == "SubProcess")
                                {
                                    number = sectioncount.ToString() + "." + subsectioncount.ToString();
                                    subsectioncount++;
                                    
                                }
                                else
                                {
                                    sectioncount++;
                                    number = sectioncount.ToString();
                                    subsectioncount = 1;
                                }

                                <div class="card sops-raci-info section-count container @protype process-@value">
                                    <div class="card-header row" role="tab" id="headingOne">
                                        <div class="col-12 col-md-1 count-col">
                                            <div class="number"><h3>@number</h3></div>
                                        </div>
                                        <div class="col-12 col-md-11 padding-left-zero">
                                            <div class="row header-row">
                                                <div class="col-12 col-md-10">
                                                     <h3>@item.ProcessName</h3>
                                                </div>
                                                <div class="col-12 col-md-2 text-right">
                                                    <a data-toggle="collapse" class="collapsed" href="#collapse-tab-@nameshort" role="button" aria-expanded="false" aria-controls="collapseOne">
                                                        SHOW DETAIL
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 status-row">
                                                @if(item.processStatus == "Complete"){
                                                    <div class="row complete-status">
                                                        <div class="col-12  col-md-1">
                                                        </div>
                                                        <div class="col-11">
                                                            <p>Completed on: @item.completedDate.ToString("dd/MM/yyyy")</p>
                                                        </div>
                                                    </div>
                                                }
                                                else {
                                                    <div class="row pending-status">
                                                        <div class="col-12 col-md-1">
                                                        </div>
                                                        <div class="col-11 status-is-pending">
                                                            @foreach(var date in (ViewBag.instpocess)){
                                                                if((date.valuematch == item.valuematch) && (date.SOPTemplateID == @ViewBag.getinstanceid)){
                                                                    <p class="the-due-date">Due: @date.DueDate</p>
                                                                }
                                                            }
                                                            <p class="the-proc-status">@item.processStatus</p>
                                                        </div>
                                                    </div>
                                                }
                                        </div>
                                    </div>
                                    <div id="collapse-tab-@nameshort" class="container collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion-history">
                                        <div class="card-body row">
                                            <div class="col-12 col-md-12">
                                                <p>@item.ProcessDesc</p>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    @foreach(var sub in (ViewBag.res)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                                <!-- Getting the first and second name from users -->
                                                                foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId && sub.UserId == ViewBag.loggedin){
                                                                        var namenospace = "resp" + name.FirstName + name.SecondName + sub.RACIResChosenID + item.valuematch;
                                                                        var mynamenospace = "mytasksresp" + name.FirstName + name.SecondName + sub.RACIResChosenID + item.valuematch;
                                                                        <div class="col-12 raci-info">
                                                                            <h4>Responsible</h4>
                                                                        </div>
                                                                        <div class="col-12 col-md-12 no-pad grey-bg">
                                                                            <div class="row">
                                                                                <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                                <h3></h3>
                                                                            </div>
                                                                            <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                                <input type="hidden" value="@item.valuematch">
                                                                                <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                                <h5>@sub.Status</h5>
                                                                            </div>
                                                                            <div class="col-12 col-md-6 sop-person d-flex flex-column align-items-center">
                                                                                <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                                <!-- Getting the department -->    
                                                                                @foreach(var dep in (ViewBag.deps)){
                                                                                    if(sub.DepartmentId == dep.DepartmentId){
                                                                                        <p class="mb-0">@dep.DepartmentName</p>
                                                                                    }
                                                                                }
                                                                            </div>
                                                                            <div class="col-12 col-md-2 sop-buttons">
                                                                                <div class="dropdown h-100">
                                                                                    <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                        <i class="material-icons">menu</i>
                                                                                    </button>
                                                                                    <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                        <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@mynamenospace"><p>Complete Task</p></div>
                                                                                        <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@mynamenospace"><p>Request recusal</p></div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="modal fade" id="comp-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                <div class="modal-dialog" role="document">
                                                                                    <div class="modal-content">
                                                                                      <div class="modal-header">
                                                                                        <h5 class="modal-title">Complete this task</h5>
                                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                          <span aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                      </div>
                                                                                      <div class="modal-body">
                                                                                        <p>Add signature</p>
                                                                                        <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                      </div>
                                                                                      <div class="modal-footer">
                                                                                        <input type="submit" class="btn" value="Complete Task" />
                                                                                      </div>
                                                                                    </div>
                                                                                  </div>
                                                                            </div>
                                                                            <div class="modal fade" id="rec-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                <div class="modal-dialog" role="document">
                                                                                    <div class="modal-content">
                                                                                      <div class="modal-header">
                                                                                        <h5 class="modal-title">Request Recusal</h5>
                                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                          <span aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                      </div>
                                                                                      <div class="modal-body">
                                                                                        <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                        <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                      </div>
                                                                                      <div class="modal-footer">
                                                                                        <input type="submit" class="btn" value="Request Recusal" />
                                                                                      </div>
                                                                                    </div>
                                                                                  </div>
                                                                            </div>

                                                                        </div>
                                                                     </div>
                                                                    }
                                                                 }
                                                        }
                                                    }
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    @foreach(var sub in (ViewBag.acc)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                                <!-- Getting the first and second name from users -->
                                                                foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId && sub.UserId == ViewBag.loggedin){
                                                                        var namenospace = "acc" + name.FirstName + name.SecondName + sub.RACIAccChosenID + item.valuematch;
                                                                        var mynamenospace = "mytasksacc" + name.FirstName + name.SecondName + sub.RACIResChosenID + item.valuematch;
                                                                        <div class="col-12 raci-info">
                                                                            <h4>Accountable</h4>
                                                                        </div>
                                                                        <div class="col-12 col-md-12 no-pad grey-bg">
                                                                            <div class="row">
                                                                                <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                                    <h3></h3>
                                                                            </div>
                                                                            <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                                <input type="hidden" value="@item.valuematch">
                                                                                <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                                <h5>@sub.Status</h5>
                                                                            </div>
                                                                            <div class="col-12 col-md-6 sop-person d-flex flex-column align-items-center">
                                                                                <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                                <!-- Getting the department -->    
                                                                                @foreach(var dep in (ViewBag.deps)){
                                                                                    if(sub.DepartmentId == dep.DepartmentId){
                                                                                        <p class="mb-0">@dep.DepartmentName</p>
                                                                                    }
                                                                                }
                                                                            </div>
                                                                            <div class="col-12 col-md-2 sop-buttons">
                                                                                <div class="dropdown h-100">
                                                                                  <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                    <i class="material-icons">menu</i>
                                                                                  </button>
                                                                                  <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                        <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@mynamenospace"><p>Complete Task</p></div>
                                                                                        <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@mynamenospace"><p>Request recusal</p></div>
                                                                                   </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="modal fade" id="comp-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                <div class="modal-dialog" role="document">
                                                                                    <div class="modal-content">
                                                                                      <div class="modal-header">
                                                                                        <h5 class="modal-title">Complete this task</h5>
                                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                          <span aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                      </div>
                                                                                      <div class="modal-body">
                                                                                        <p>Add signature</p>
                                                                                        <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                      </div>
                                                                                      <div class="modal-footer">
                                                                                        <input type="submit" class="btn" value="Complete Task" />
                                                                                      </div>
                                                                                    </div>
                                                                                  </div>
                                                                            </div>
                                                                            <div class="modal fade" id="rec-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                <div class="modal-dialog" role="document">
                                                                                    <div class="modal-content">
                                                                                      <div class="modal-header">
                                                                                        <h5 class="modal-title">Request Recusal</h5>
                                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                          <span aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                      </div>
                                                                                      <div class="modal-body">
                                                                                        <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                        <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                      </div>
                                                                                      <div class="modal-footer">
                                                                                        <input type="submit" class="btn" value="Request Recusal" />
                                                                                      </div>
                                                                                    </div>
                                                                                  </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    }
                                                                 }
                                                        }
                                                    }

                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    @foreach(var sub in (ViewBag.cons)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                                <!-- Getting the first and second name from users -->
                                                                foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId && sub.UserId == ViewBag.loggedin){
                                                                        var namenospace = "cons" + name.FirstName + name.SecondName + sub.RACIConChosenID + item.valuematch;
                                                                        var mynamenospace = "mytaskscons" + name.FirstName + name.SecondName + sub.RACIResChosenID + item.valuematch;
                                                                        <div class="col-12 raci-info">
                                                                            <h4>Consulted</h4>
                                                                        </div>
                                                                        <div class="col-12 col-md-12 no-pad grey-bg">
                                                                         <div class="row">
                                                                        <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                            <h3></h3>
                                                                        </div>
                                                                        <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                            <input type="hidden" value="@item.valuematch">
                                                                            <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                            <h5>@sub.Status</h5>
                                                                        </div>
                                                                        <div class="col-12 col-md-6 sop-person d-flex flex-column align-items-center">
                                                                            <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                            <!-- Getting the department -->    
                                                                            @foreach(var dep in (ViewBag.deps)){
                                                                                if(sub.DepartmentId == dep.DepartmentId){
                                                                                    <p class="mb-0">@dep.DepartmentName</p>
                                                                                }
                                                                            }
                                                                        </div>
                                                                        <div class="col-12 col-md-2 sop-buttons">
                                                                            <div class="dropdown h-100">
                                                                              <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i class="material-icons">menu</i>
                                                                              </button>
                                                                              <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                        <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@mynamenospace"><p>Complete Task</p></div>
                                                                                        <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@mynamenospace"><p>Request recusal</p></div>
                                                                                   </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="modal fade" id="comp-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Complete this task</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>Add signature</p>
                                                                                    <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Complete Task" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        <div class="modal fade" id="rec-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                  <div class="modal-header">
                                                                                    <h5 class="modal-title">Request Recusal</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                      <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                  </div>
                                                                                  <div class="modal-body">
                                                                                    <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                    <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                  </div>
                                                                                  <div class="modal-footer">
                                                                                    <input type="submit" class="btn" value="Request Recusal" />
                                                                                  </div>
                                                                                </div>
                                                                              </div>
                                                                        </div>
                                                                        </div>
                                                            </div>
                                                                    }
                                                                 }

                                                        }
                                                    }
                                                
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-12">
                                                <div class="row">
                                                    @foreach(var sub in (ViewBag.infi)){
                                                        if((sub.valuematch == item.valuematch) && (sub.InstanceId == ViewBag.getinstanceid)){
                                                                <!-- Getting the first and second name from users -->
                                                                foreach(var name in (ViewBag.allusers)){
                                                                    if(sub.UserId == name.ClaimId  && sub.UserId == ViewBag.loggedin){
                                                                        var namenospace = "infi" + name.FirstName + name.SecondName + sub.RACIInfChosenID + item.valuematch;
                                                                        var mynamenospace = "mytasksinfi" + name.FirstName + name.SecondName + sub.RACIResChosenID + item.valuematch;
                                                                        <div class="col-12 raci-info">
                                                                            <h4>Informed</h4>
                                                                        </div>
                                                                        <div class="col-12 col-md-12 no-pad grey-bg">
                                                                            <div class="row">
                                                                                <div class="col-12 col-md-1 sop-number sop-number-@item.valuematch">
                                                                                <h3></h3>
                                                                            </div>
                                                                                <div class="col-12 col-md-3 @sub.Status sop-status">
                                                                                    <input type="hidden" value="@item.valuematch">
                                                                                    <input type="text" class="hidden-value raci-number-@namenospace" value="@sub.Status" name="sop-number-@namenospace">
                                                                                    <h5>@sub.Status</h5>
                                                                                </div>
                                                                                <div class="col-12 col-md-6 sop-person d-flex flex-column align-items-center">
                                                                                    <h4 class="h5">@name.FirstName @name.SecondName</h4>
                                                                                    <!-- Getting the department -->    
                                                                                    @foreach(var dep in (ViewBag.deps)){
                                                                                        if(sub.DepartmentId == dep.DepartmentId){
                                                                                            <p class="mb-0">@dep.DepartmentName</p>
                                                                                        }
                                                                                    }
                                                                                </div>
                                                                                <div class="col-12 col-md-2 sop-buttons">
                                                                                    <div class="dropdown h-100">
                                                                                      <button class="btn btn-secondary h-100 w-100" type="button" id="@namenospace" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                        <i class="material-icons">menu</i>
                                                                                      </button>
                                                                                      <div class="dropdown-menu" aria-labelledby="@namenospace">
                                                                                        <div class="complete user-@sub.UserId comp-@namenospace" data-toggle="modal" data-target="#comp-@mynamenospace"><p>Complete Task</p></div>
                                                                                        <div class="recusal user-@sub.UserId rec-@namenospace" data-toggle="modal" data-target="#rec-@mynamenospace"><p>Request recusal</p></div>
                                                                                      </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="modal fade" id="comp-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                    <div class="modal-dialog" role="document">
                                                                                        <div class="modal-content">
                                                                                          <div class="modal-header">
                                                                                            <h5 class="modal-title">Complete this task</h5>
                                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                              <span aria-hidden="true">&times;</span>
                                                                                            </button>
                                                                                          </div>
                                                                                          <div class="modal-body">
                                                                                            <p>Add signature</p>
                                                                                            <input type="text" name="signature-@namenospace" placeholder="please type your name" class="signature">
                                                                                          </div>
                                                                                          <div class="modal-footer">
                                                                                            <input type="submit" class="btn" value="Complete Task" />
                                                                                          </div>
                                                                                        </div>
                                                                                      </div>
                                                                                </div>
                                                                                <div class="modal fade" id="rec-@mynamenospace" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                                    <div class="modal-dialog" role="document">
                                                                                        <div class="modal-content">
                                                                                            <div class="modal-header">
                                                                                                <h5 class="modal-title">Request Recusal</h5>
                                                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                                    <span aria-hidden="true">&times;</span>
                                                                                                </button>
                                                                                            </div>
                                                                                            <div class="modal-body">
                                                                                                <p>You are about to recuse yourself from this task. Are you sure you want to continue?</p>
                                                                                                <input type="text" name="recuse-@namenospace" placeholder="please type your name" class="signature">
                                                                                            </div>
                                                                                            <div class="modal-footer">
                                                                                                <input type="submit" class="btn" value="Request Recusal" />
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    }
                                                                 }
                                                        }
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="tab-pane" id="docs" role="tabpanel">
                         <div class="row">
                            <div class="col-12 col-md-7"></div>
                            <div class="col-12 col-md-3 files-upload">
                                <input type="file" name="files" multiple="multiple"> 
                            </div>
                            <div class="col-12 col-md-2 files-upload">
                                <input type="submit" class="btn blue-btn" value="Add Files" />
                            </div>
                        </div>
                        @foreach(var item in (ViewBag.files)){
                            <div class="row">
                                @foreach(var img in item.ProcessFiles){
                                    <div class="col-6 col-sm-3 col-md-1 mt-3">
                                        <a href="@img" download="">
                                            <img src="~/images/docIcon.png"/>
                                        </a>
                                    </div>
                                 }
                            </div>
                        }
                    </div>

                    
                </div>
            </div>
        </div>
        
    </div>
   </form>
</div>
<script>
    $(document).ready(function () {
        var url = '@Url.Action("TheSOP")';
        var form = $('form');
        var recipients = $('#overview');    
        $.get(url, function(response) {
            recipients.append(response);
            form.data('validator', null);
            $.validator.unobtrusive.parse(form);
        });
    });
    $(document).ready(function () {
        var divname = "cols-";
        var count = $(".table .inner-cols").length;
        var content = divname+count;
        $(".inner-cols").addClass(content);
        $(".inner-rows").addClass(content);
    });
    var div = 0;
    /* NOT QUITE AS OLD
    $(document).ready(function () {
        var i = 0;
        $(".section-count").each(function() {
            var j = 1;
            if($(this).hasClass("SubProcess")){
                $(this).find(".number").find("h3").text(i + "." + j);
                j++;
            }
            else {
    i++;
                $(this).find(".number").find("h3").text(i);

            }
        });
    });
    */
    /* OLD
    $(document).ready(function () {
        $(".number").each(function(i) {
            $(this).find("h3").text(++i);
        });
    });
    */

    $(document).ready(function() {
       var $arr = $("a[data-toggle='collapse']");
        $arr.each(function(){
             $(this).click(function(){
                if($(this).hasClass('collapsed')){
                    $(this).html('HIDE DETAIL');
                    $arr.not(this).each(function(){
                        $(this).html('SHOW DETAIL');
                    });
                }
                else{
                    $(this).html('SHOW DETAIL');
                }
            });
        });
    
    });
    $(document).ready(function() {
        $(".complete").not(".user-@ViewBag.loggedin").addClass("notlive");
        $(".recusal").not(".user-@ViewBag.loggedin").addClass("notlive");
    });

    var countsections = $(".process-count").length;
    console.log(countsections);

    if($(".process-count").length > 1){
       $(".process-count:nth-child(2n)").addClass("fade-this");
    }

    var activelcass = "Active";
    
    $(".process-count:nth-child(1)").addClass("status-active");
    $(".process-count.status-is-Complete").next(".process-count").addClass("status-active");

    if($(".process-count").hasClass(".status-active")){
        $("this").children(".status-row").css("color", "blue");
    }
    if ($(".process-count").is(".status-active")){
        $(".process-count.status-active .status-row .pending-status .status-is-pending p.the-proc-status").text("ACTIVE");
    }

</script>

